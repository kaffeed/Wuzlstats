@model Wuzlstats.ViewModels.Home.IndexViewModel

<div class="bg-blue-50 border-l-4 border-blue-400 p-4 mb-4" id="loadingAlert" role="alert">
    <p class="text-blue-700">
        Establishing real-time connection to league. This may take a second or two, please be patient ...
    </p>
</div>

<div class="flex flex-wrap -mx-4">
    <div class="w-full md:w-1/2 px-4 mb-6">
        <div id="scoreBox" class="score-box">
            <partial name="_Score" />
            <div id="leagueMenuBar" class="mt-6" style="display: none;">
                <div class="flex flex-wrap gap-2 justify-end">
                    <button id="replayButton" class="px-3 py-1.5 bg-white border border-gray-300 rounded text-sm hover:bg-gray-50 transition-colors">Replay</button>
                    <button id="switchSidesButton" class="px-3 py-1.5 bg-white border border-gray-300 rounded text-sm hover:bg-gray-50 transition-colors">Switch sides</button>
                    <button id="switchPositionsButton" class="px-3 py-1.5 bg-white border border-gray-300 rounded text-sm hover:bg-gray-50 transition-colors">Switch positions</button>
                    <a href="@Url.Action("Games", "Home", new { league = Model.Name })" class="px-3 py-1.5 bg-white border border-gray-300 rounded text-sm hover:bg-gray-50 transition-colors">View / delete games</a>
                </div>
            </div>
        </div>
        <div class="mt-6">
            <h3 class="text-center text-xl font-bold mb-4">League trivia</h3>
            <div id="leagueStatistics">
                <div class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                    <div class="progress-bar-animated h-full" style="width: 100%"></div>
                </div>
            </div>
        </div>
    </div>
    <div class="w-full md:w-1/2 px-4">
        <div class="flex flex-wrap -mx-4 mb-6">
            <div class="w-full sm:w-1/2 px-4 mb-6">
                <h3 class="text-center text-xl font-bold mb-4">
                    <a href="@Url.Action("Index", "Players", new { league = Model.Name, sort = "best", recent = true })" class="text-blue-600 hover:text-blue-800 transition-colors">The best players</a>
                </h3>
                <ul id="bestPlayerRanking" class="ranking">
                    <li class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div class="progress-bar-animated h-full" style="width: 100%"></div>
                    </li>
                </ul>
            </div>
            <div class="w-full sm:w-1/2 px-4 mb-6">
                <h3 class="text-center text-xl font-bold mb-4">
                    <a href="@Url.Action("Index", "Players", new { league = Model.Name, sort = "worst", recent = true })" class="text-blue-600 hover:text-blue-800 transition-colors">The worst players</a>
                </h3>
                <ul id="worstPlayerRanking" class="ranking">
                    <li class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div class="progress-bar-animated h-full" style="width: 100%"></div>
                    </li>
                </ul>
            </div>
        </div>
        <div class="flex flex-wrap -mx-4">
            <div class="w-full sm:w-1/2 px-4">
                <h3 class="text-center text-xl font-bold mb-4">
                    <a href="@Url.Action("Index", "Teams", new { league = Model.Name, sort = "best", recent = true })" class="text-blue-600 hover:text-blue-800 transition-colors">The best teams</a>
                </h3>
                <ul id="bestTeamRanking" class="ranking">
                    <li class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div class="progress-bar-animated h-full" style="width: 100%"></div>
                    </li>
                </ul>
            </div>
            <div class="w-full sm:w-1/2 px-4">
                <h3 class="text-center text-xl font-bold mb-4">
                    <a href="@Url.Action("Index", "Teams", new { league = Model.Name, sort = "worst", recent = true })" class="text-blue-600 hover:text-blue-800 transition-colors">The worst teams</a>
                </h3>
                <ul id="worstTeamRanking" class="ranking">
                    <li class="w-full bg-gray-200 rounded-full h-4 overflow-hidden">
                        <div class="progress-bar-animated h-full" style="width: 100%"></div>
                    </li>
                </ul>
            </div>
        </div>
    </div>
</div>

@* ReSharper disable once Razor.SectionNotResolved *@
@section scripts {
    <script>
        app.config.init(unescape('@Url.Action("Index", "Player", new { id = "[id]"})'));

        app.initSignalR();
        app.initScore('@Model.Name');

        app.apiHub.on("reloadStatistics", function(statistics) {
            console.log("Rendering statistics ...");

            app.renderLeagueStatistics($('#leagueStatistics'), statistics);
            app.renderPlayerRanking($('#bestPlayerRanking'), statistics.bestPlayers);
            app.renderPlayerRanking($('#worstPlayerRanking'), statistics.worstPlayers);
            app.renderTeamRanking($('#bestTeamRanking'), statistics.bestTeams);
            app.renderTeamRanking($('#worstTeamRanking'), statistics.worstTeams);
        });

        app.autoPageReload();

        app.connectSignalR('@Model.Name', function() {
            // Remove loading alert with fade effect
            var alert = document.getElementById('loadingAlert');
            if (alert) {
                alert.classList.add('opacity-0', 'transition-opacity', 'duration-300');
                setTimeout(function() { alert.remove(); }, 300);
            }
        });

        app.registerLeagueMenuBar();
    </script>
}
